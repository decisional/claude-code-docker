version: '3.8'

services:
  claude-code:
    build: .
    container_name: claude-code-env
    stdin_open: true
    tty: true
    env_file:
      - .env
    environment:
      # Git repository configuration (loaded from .env)
      - GIT_REPO_URL=${GIT_REPO_URL}
      - GIT_BRANCH=${GIT_BRANCH}
      - GIT_CLONE_DIR=${GIT_CLONE_DIR}
      # Set HOME to ensure Claude Code uses /home/claude/.claude
      - HOME=/home/claude
      # Claude Code configuration directory
      - CLAUDE_CONFIG_DIR=/home/claude/.claude
      # Claude Code runtime flags (loaded from .env)
      - CLAUDE_SKIP_PERMISSIONS=${CLAUDE_SKIP_PERMISSIONS:-false}
    volumes:
      # Mount your project directory
      - ./workspace:/workspace
      # Mount Claude credentials with write access (for memories and settings)
      - ./claude-data:/home/claude/.claude
      # Mount Git config with write access (for git operations and storage)
      - ./git-data/.gitconfig:/home/claude/.gitconfig
      # Mount SSH keys with write access (for git clone/push operations)
      - ./git-data/.ssh:/home/claude/.ssh
    working_dir: /workspace
    user: "1000:1000"
