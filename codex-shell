#!/bin/bash
# Open a zsh shell in a Codex CLI instance
# Usage: ./codex-shell [instance-name]
# If no name provided, uses current directory name

set -e

# Get instance name from argument or use current directory name
if [ -n "$1" ]; then
    INSTANCE_NAME="$1"
else
    INSTANCE_NAME=$(basename "$(pwd)")
fi

PROJECT_NAME="codex-${INSTANCE_NAME}"
CONTAINER_NAME="${PROJECT_NAME}-claude-code-1"

echo "üêö Opening zsh shell in instance: $INSTANCE_NAME"
echo ""

# Check if container exists and is running
if docker ps -q -f name="^${CONTAINER_NAME}$" 2>/dev/null | grep -q .; then
    docker-compose -p "$PROJECT_NAME" exec -it claude-code zsh
else
    if docker ps -aq -f name="^${CONTAINER_NAME}$" 2>/dev/null | grep -q .; then
        echo "‚ùå Container exists but is not running"
        echo "   Use './codex-start $INSTANCE_NAME' to start it"
    else
        echo "‚ùå No container found for instance: $INSTANCE_NAME"
        echo "   Use './codex-start $INSTANCE_NAME' to create it"
        echo ""
        echo "Available instances:"
        docker ps -a --filter "name=codex-" --format "  - {{.Names}}" | sed 's/-claude-code-1//' | sed 's/codex-//'
    fi
    exit 1
fi
