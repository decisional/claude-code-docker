# Screenshot Handling in Workflow Orchestrator

## How It Works

When you start a workflow with a Linear ticket that has screenshots or image attachments, the orchestrator automatically:

### 1. **Downloads Screenshots**
```
workflows/wf_abc123/
├── attachments/
│   ├── screenshot-1.png
│   ├── mockup.jpg
│   └── design.png
```

All image attachments from the Linear ticket are downloaded to the `attachments/` directory.

### 2. **Embeds in Ticket Markdown**
The `linear-ticket.md` file includes inline image references:

```markdown
## Attachments & Screenshots

### Screenshot 1
![Screenshot 1](./attachments/screenshot-1.png)
_Image file: `./attachments/screenshot-1.png`_
```

### 3. **Creates Screenshots Manifest**
A dedicated `SCREENSHOTS.md` file is created with explicit instructions:

```markdown
# Screenshots & Attachments

**IMPORTANT: Use the Read tool to view each image below.**

## screenshot-1.png
**File:** `./attachments/screenshot-1.png`
**To view:** Use Read tool on `./attachments/screenshot-1.png`
![screenshot-1.png](./attachments/screenshot-1.png)
```

### 4. **Agents View Screenshots**

Both the **Planner** and **Executor** agents are instructed to:

1. **First**, check if `SCREENSHOTS.md` exists
2. **Read** the SCREENSHOTS.md file
3. **Use the Read tool** to view each image file listed
4. **Analyze** the visual requirements before planning/implementing

## Example Flow

```bash
$ ./workflow start DEC-123
# Ticket has 2 screenshots attached

# Orchestrator creates:
workflows/wf_abc123/
├── linear-ticket.md          # Ticket with embedded images
├── SCREENSHOTS.md            # Manifest of all images
└── attachments/
    ├── login-screen.png      # Downloaded image
    └── user-profile.png      # Downloaded image

# Planner agent (Codex) starts and:
# 1. Reads SCREENSHOTS.md
# 2. Uses Read tool on ./attachments/login-screen.png (sees the image)
# 3. Uses Read tool on ./attachments/user-profile.png (sees the image)
# 4. Reads linear-ticket.md for full context
# 5. Creates plan.md with visual requirements noted

# Executor agent (Claude) starts and:
# 1. Reads SCREENSHOTS.md
# 2. Uses Read tool on each screenshot (sees the images)
# 3. Reads plan.md
# 4. Implements matching the visual requirements
# 5. Creates PR
```

## Agent Support

### Claude Code
- ✅ Can read PNG, JPG, JPEG, GIF, WebP images
- ✅ Multimodal - understands visual content
- ✅ Can analyze UI layouts, colors, spacing, etc.

### OpenAI Codex CLI
- ✅ Supports image viewing (if using vision-capable models)
- ✅ Can analyze screenshots when using GPT-4V or later

## File Structure

```
workflows/wf_abc123/
├── metadata.json              # Workflow state
├── linear-ticket.md           # Full ticket (with embedded images)
├── SCREENSHOTS.md             # Screenshot manifest
├── attachments/               # Downloaded images
│   ├── screenshot-1.png
│   └── mockup.jpg
├── plan.md                    # Generated by planner
└── .workflow-status.json      # Agent status signals
```

## Tips for Linear Tickets

1. **Attach screenshots directly** to the Linear ticket (not just links)
2. **Name screenshots descriptively**: "login-page.png" vs "image.png"
3. **Include multiple angles** if showing complex UI
4. **Add annotations** to screenshots if specific details are important

## Verification

To verify screenshots are properly handled:

```bash
# After starting a workflow
$ ./workflow show wf_abc123

# Check the workflow directory
$ ls workflows/wf_abc123/attachments/
login-screen.png  user-profile.png

# View the screenshots manifest
$ cat workflows/wf_abc123/SCREENSHOTS.md

# Check planner logs to see if it read the images
$ ./workflow logs wf_abc123 | grep -i screenshot
```

## Troubleshooting

**Q: Agent isn't looking at screenshots**
- Check if SCREENSHOTS.md was created: `ls workflows/wf_abc123/SCREENSHOTS.md`
- Verify images were downloaded: `ls workflows/wf_abc123/attachments/`
- Review agent logs to see if Read tool was used

**Q: Images not downloading**
- Check Linear ticket has attachments
- Verify Linear API key has correct permissions
- Check orchestrator logs for download errors

**Q: Agent can't see image content**
- Ensure using Claude Code or Codex with vision capabilities
- Verify image files are valid (not corrupted)
- Check file paths are correct in SCREENSHOTS.md
